{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./src/telemetry.js","webpack:///./src/utils/i18n.js","webpack:///./src/storage/store.js","webpack:///./src/assets/avatars/avatars.js","webpack:///./src/utils/identity.js","webpack:///./src/link.js","webpack:///./src/react-components/link-root.js","webpack:///./src/assets/stylesheets/link.scss","webpack:///./src/assets/images/logo.svg","webpack:///./src/utils/link-channel.js","webpack:///./src/utils/crypto.js","webpack:///./src/utils/phoenix-utils.js","webpack:///./src/utils/disable-ios-zoom.js"],"names":["webpackJsonpCallback","data","moduleId","chunkId","chunkIds","moreModules","executeModules","i","resolves","length","installedChunks","push","Object","prototype","hasOwnProperty","call","modules","parentJsonpFunction","shift","deferredModules","apply","checkDeferredModules","result","deferredModule","fulfilled","j","depId","splice","__webpack_require__","s","installedModules","4","exports","module","l","m","c","d","name","getter","o","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","p","jsonpArray","window","oldJsonpFunction","slice","Raven","config","install","_ravenJs","_translationsData","navigatorLang","navigator","languages","language","userLanguage","toLowerCase","split","lang","localeData","messages","en","_jsonschema","_deepmerge","_eventTargetShim","_identity","LOCAL_STORE_KEY","STORE_STATE_CACHE_KEY","validator","Validator","SCHEMA","id","definitions","profile","type","additionalProperties","properties","displayName","pattern","avatarId","activity","hasFoundFreeze","hasChangedName","lastEnteredAt","settings","lastUsedMicDeviceId","$ref","Store","_classCallCheck","this","_this","_possibleConstructorReturn","__proto__","getPrototypeOf","init","update","generateDefaultProfile","state","generateRandomName","localStorage","getItem","setItem","JSON","stringify","newState","finalState","_deepmerge2","default","isValid","validate","valid","Error","dispatchEvent","CustomEvent","parse","EventTarget","avatars","model","selectRandom","names","Math","floor","random","avatarIds","_avatars","arr","map","av","_react","_reactDom","_telemetry","_linkRoot","_linkChannel","_phoenixUtils","_store","_telemetry2","socket","connectToReticulum","store","linkChannel","LinkChannel","setSocket","ReactDOM","render","_react2","createElement","_linkRoot2","document","getElementById","_propTypes","_reactIntl","_en","_i18n","_classnames","_link","_disableIosZoom","MAX_DIGITS","addLocaleData","concat","_toConsumableArray","disableiOSZoom","LinkRoot","enteredDigits","failedAtLeastOnce","componentDidMount","addEventListener","handleKeyDown","componentWillUnmount","removeEventListener","e","keyCode","preventDefault","stopPropagation","addDigit","digit","newDigits","attemptLink","setState","removeDigit","substring","code","props","then","response","path","location","href","catch","message","_this2","IntlProvider","locale","className","styles","link","linkContents","_classnames2","codeLoadingPanel","enteredContents","header","FormattedMessage","digitInput","onChange","ev","target","placeholder","enteredFooter","entryFooterImage","src","_image","keypad","disabled","keypadButton","onClick","keypadZeroButton","keypadBackspace","footer","footerImage","alt","Component","propTypes","intl","PropTypes","keypad-button","link-contents","entered-footer","entered-contents","code-loading-panel","entry-footer-image","footer-image","keypad-zero-button","keypad-backspace","entered-digits","digit-input","_crypto","generateCode","Promise","resolve","onFinished","finished","step","toString","padStart","readyToSend","leftChannel","channel","timeout","leave","cancel","on","keys","incoming","pathname","_extends","generatePublicKeyAndEncryptedObject","public_key","_ref","publicKeyString","encryptedData","payload","target_session_id","reply_to_session_id","join","receive","console","error","reject","generateKeys","_ref2","privateKey","numOccupants","params","session_id","setTimeout","warn","decryptObject","publicKey","crypto","subtle","deriveKey","public","exportKey","importKey","namedCurve","keyPair","generateKey","publicKeyToString","incomingPublicKeyString","obj","iv","Uint8Array","incomingPublicKey","stringToPublicKey","secret","btoa","arrayBufferToString","encrypt","stringToArrayBuffer","base64value","ciphertext","atob","decrypt","buf","charCodeAt","b","byteLength","String","fromCharCode","qs","URLSearchParams","search","socketProtocol","protocol","socketHost","socketPort","_process$env$RETICULU","_process$env$RETICULU2","_slicedToArray","retHost","retPort","socketUrl","log","Socket","_v2","connect","_v","_phoenix","_detectBrowser","detectOS","userAgent","lastTouchAtMs","scale","now","Date","getTime","isDoubleTouch"],"mappings":"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","file":"assets/js/link-302505e9fe7a80069e7b.js","sourcesContent":[" \t// install a JSONP callback for chunk loading\n \tfunction webpackJsonpCallback(data) {\n \t\tvar chunkIds = data[0];\n \t\tvar moreModules = data[1];\n \t\tvar executeModules = data[2];\n\n \t\t// add \"moreModules\" to the modules object,\n \t\t// then flag all \"chunkIds\" as loaded and fire callback\n \t\tvar moduleId, chunkId, i = 0, resolves = [];\n \t\tfor(;i < chunkIds.length; i++) {\n \t\t\tchunkId = chunkIds[i];\n \t\t\tif(installedChunks[chunkId]) {\n \t\t\t\tresolves.push(installedChunks[chunkId][0]);\n \t\t\t}\n \t\t\tinstalledChunks[chunkId] = 0;\n \t\t}\n \t\tfor(moduleId in moreModules) {\n \t\t\tif(Object.prototype.hasOwnProperty.call(moreModules, moduleId)) {\n \t\t\t\tmodules[moduleId] = moreModules[moduleId];\n \t\t\t}\n \t\t}\n \t\tif(parentJsonpFunction) parentJsonpFunction(data);\n\n \t\twhile(resolves.length) {\n \t\t\tresolves.shift()();\n \t\t}\n\n \t\t// add entry modules from loaded chunk to deferred list\n \t\tdeferredModules.push.apply(deferredModules, executeModules || []);\n\n \t\t// run deferred modules when all chunks ready\n \t\treturn checkDeferredModules();\n \t};\n \tfunction checkDeferredModules() {\n \t\tvar result;\n \t\tfor(var i = 0; i < deferredModules.length; i++) {\n \t\t\tvar deferredModule = deferredModules[i];\n \t\t\tvar fulfilled = true;\n \t\t\tfor(var j = 1; j < deferredModule.length; j++) {\n \t\t\t\tvar depId = deferredModule[j];\n \t\t\t\tif(installedChunks[depId] !== 0) fulfilled = false;\n \t\t\t}\n \t\t\tif(fulfilled) {\n \t\t\t\tdeferredModules.splice(i--, 1);\n \t\t\t\tresult = __webpack_require__(__webpack_require__.s = deferredModule[0]);\n \t\t\t}\n \t\t}\n \t\treturn result;\n \t}\n\n \t// The module cache\n \tvar installedModules = {};\n\n \t// object to store loaded and loading chunks\n \t// undefined = chunk not loaded, null = chunk preloaded/prefetched\n \t// Promise = chunk loading, 0 = chunk loaded\n \tvar installedChunks = {\n \t\t4: 0\n \t};\n\n \tvar deferredModules = [];\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"/\";\n\n \tvar jsonpArray = window[\"webpackJsonp\"] = window[\"webpackJsonp\"] || [];\n \tvar oldJsonpFunction = jsonpArray.push.bind(jsonpArray);\n \tjsonpArray.push = webpackJsonpCallback;\n \tjsonpArray = jsonpArray.slice();\n \tfor(var i = 0; i < jsonpArray.length; i++) webpackJsonpCallback(jsonpArray[i]);\n \tvar parentJsonpFunction = oldJsonpFunction;\n\n\n \t// add entry module to deferred list\n \tdeferredModules.push([430,0]);\n \t// run deferred modules when ready\n \treturn checkDeferredModules();\n","import Raven from \"raven-js\";\n\nexport default function registerTelemetry() {\n  if (process.env.NODE_ENV === \"production\") {\n    Raven.config(\"https://013d6a364fed43cdb0539a61d520597a@sentry.prod.mozaws.net/370\").install();\n  }\n}\n","import localeData from \"../assets/translations.data.json\";\nconst navigatorLang = ((navigator.languages && navigator.languages[0]) || navigator.language || navigator.userLanguage)\n  .toLowerCase()\n  .split(/[_-]+/)[0];\nexport const lang = (localeData[navigatorLang] && navigatorLang) || \"en\";\nexport const messages = localeData[lang] || localeData.en;\n","import { Validator } from \"jsonschema\";\nimport merge from \"deepmerge\";\n\nconst LOCAL_STORE_KEY = \"___hubs_store\";\nconst STORE_STATE_CACHE_KEY = Symbol();\nconst validator = new Validator();\nimport { EventTarget } from \"event-target-shim\";\nimport { generateDefaultProfile, generateRandomName } from \"../utils/identity.js\";\n\n// Durable (via local-storage) schema-enforced state that is meant to be consumed via forward data flow.\n// (Think flux but with way less incidental complexity, at least for now :))\nexport const SCHEMA = {\n  id: \"/HubsStore\",\n\n  definitions: {\n    profile: {\n      type: \"object\",\n      additionalProperties: false,\n      properties: {\n        displayName: { type: \"string\", pattern: \"^[A-Za-z0-9-]{3,32}$\" },\n        avatarId: { type: \"string\" }\n      }\n    },\n\n    activity: {\n      type: \"object\",\n      additionalProperties: false,\n      properties: {\n        hasFoundFreeze: { type: \"boolean\" },\n        hasChangedName: { type: \"boolean\" },\n        lastEnteredAt: { type: \"string\" }\n      }\n    },\n\n    settings: {\n      type: \"object\",\n      additionalProperties: false,\n      properties: {\n        lastUsedMicDeviceId: { type: \"string\" }\n      }\n    }\n  },\n\n  type: \"object\",\n\n  properties: {\n    profile: { $ref: \"#/definitions/profile\" },\n    activity: { $ref: \"#/definitions/activity\" },\n    settings: { $ref: \"#/definitions/settings\" }\n  },\n\n  additionalProperties: false\n};\n\nexport default class Store extends EventTarget {\n  constructor() {\n    super();\n\n    if (localStorage.getItem(LOCAL_STORE_KEY) === null) {\n      localStorage.setItem(LOCAL_STORE_KEY, JSON.stringify({}));\n    }\n  }\n\n  // Initializes store with any default bits\n  init = () => {\n    this.update({\n      activity: {},\n      settings: {},\n      profile: { ...generateDefaultProfile(), ...(this.state.profile || {}) }\n    });\n\n    // Regenerate name to encourage users to change it.\n    if (!this.state.activity.hasChangedName) {\n      this.update({ profile: { displayName: generateRandomName() } });\n    }\n  };\n\n  get state() {\n    if (!this.hasOwnProperty(STORE_STATE_CACHE_KEY)) {\n      this[STORE_STATE_CACHE_KEY] = JSON.parse(localStorage.getItem(LOCAL_STORE_KEY));\n    }\n\n    return this[STORE_STATE_CACHE_KEY];\n  }\n\n  update(newState) {\n    const finalState = merge(this.state, newState);\n    const isValid = validator.validate(finalState, SCHEMA).valid;\n\n    if (!isValid) {\n      throw new Error(`Write of ${JSON.stringify(finalState)} to store failed schema validation.`);\n    }\n\n    localStorage.setItem(LOCAL_STORE_KEY, JSON.stringify(finalState));\n    delete this[STORE_STATE_CACHE_KEY];\n\n    this.dispatchEvent(new CustomEvent(\"statechanged\"));\n\n    return finalState;\n  }\n}\n","export const avatars = [\n  {\n    id: \"botdefault\",\n    model: \"https://asset-bundles-prod.reticulum.io/bots/BotDefault_Avatar-9f71f8ff22.gltf\"\n  },\n  {\n    id: \"botbobo\",\n    model: \"https://asset-bundles-prod.reticulum.io/bots/BotBobo_Avatar-f9740a010b.gltf\"\n  },\n  {\n    id: \"botdom\",\n    model: \"https://asset-bundles-prod.reticulum.io/bots/BotDom_Avatar-0c48bf15a5.gltf\"\n  },\n  {\n    id: \"botgreg\",\n    model: \"https://asset-bundles-prod.reticulum.io/bots/BotGreg_Avatar-98d39797bb.gltf\"\n  },\n  {\n    id: \"botguest\",\n    model: \"https://asset-bundles-prod.reticulum.io/bots/BotGuest_Avatar-78cd857332.gltf\"\n  },\n  {\n    id: \"botjim\",\n    model: \"https://asset-bundles-prod.reticulum.io/bots/BotJim_Avatar-d28005a687.gltf\"\n  },\n  {\n    id: \"botkev\",\n    model: \"https://asset-bundles-prod.reticulum.io/bots/BotKev_Avatar-a95787bb51.gltf\"\n  },\n  {\n    id: \"botpinky\",\n    model: \"https://asset-bundles-prod.reticulum.io/bots/BotPinky_Avatar-b0b93f8675.gltf\"\n  },\n  {\n    id: \"botrobert\",\n    model: \"https://asset-bundles-prod.reticulum.io/bots/BotRobert_Avatar-e9554880f3.gltf\"\n  },\n  {\n    id: \"botwoody\",\n    model: \"https://asset-bundles-prod.reticulum.io/bots/BotWoody_Avatar-0140485a23.gltf\"\n  }\n];\n","import { avatars } from \"../assets/avatars/avatars.js\";\n\nconst names = [\n  \"Baers-Pochard\",\n  \"Baikal-Teal\",\n  \"Barrows-Goldeneye\",\n  \"Blue-Billed\",\n  \"Blue-Duck\",\n  \"Blue-Winged\",\n  \"Brown-Teal\",\n  \"Bufflehead\",\n  \"Canvasback\",\n  \"Cape-Shoveler\",\n  \"Chestnut-Teal\",\n  \"Chiloe-Wigeon\",\n  \"Cinnamon-Teal\",\n  \"Comb-Duck\",\n  \"Common-Eider\",\n  \"Common-Goldeneye\",\n  \"Common-Merganser\",\n  \"Common-Pochard\",\n  \"Common-Scoter\",\n  \"Common-Shelduck\",\n  \"Cotton-Pygmy\",\n  \"Crested-Duck\",\n  \"Crested-Shelduck\",\n  \"Eatons-Pintail\",\n  \"Falcated\",\n  \"Ferruginous\",\n  \"Freckled-Duck\",\n  \"Gadwall\",\n  \"Garganey\",\n  \"Greater-Scaup\",\n  \"Green-Pygmy\",\n  \"Grey-Teal\",\n  \"Hardhead\",\n  \"Harlequin\",\n  \"Hartlaubs\",\n  \"Hooded-Merganser\",\n  \"Hottentot-Teal\",\n  \"Kelp-Goose\",\n  \"King-Eider\",\n  \"Lake-Duck\",\n  \"Laysan-Duck\",\n  \"Lesser-Scaup\",\n  \"Long-Tailed\",\n  \"Maccoa-Duck\",\n  \"Mallard\",\n  \"Mandarin\",\n  \"Marbled-Teal\",\n  \"Mellers-Duck\",\n  \"Merganser\",\n  \"Northern-Pintail\",\n  \"Orinoco-Goose\",\n  \"Paradise-Shelduck\",\n  \"Plumed-Whistler\",\n  \"Puna-Teal\",\n  \"Pygmy-Goose\",\n  \"Radjah-Shelduck\",\n  \"Red-Billed\",\n  \"Red-Crested\",\n  \"Red-Shoveler\",\n  \"Ring-Necked\",\n  \"Ringed-Teal\",\n  \"Rosy-Billed\",\n  \"Ruddy-Shelduck\",\n  \"Salvadoris-Teal\",\n  \"Scaly-Sided\",\n  \"Shelduck\",\n  \"Shoveler\",\n  \"Silver-Teal\",\n  \"Smew\",\n  \"Spectacled-Eider\",\n  \"Spot-Billed\",\n  \"Spotted-Whistler\",\n  \"Steamerduck\",\n  \"Stellers-Eider\",\n  \"Sunda-Teal\",\n  \"Surf-Scoter\",\n  \"Tufted-Duck\",\n  \"Velvet-Scoter\",\n  \"Wandering-Whistler\",\n  \"Whistling-duck\",\n  \"White-Backed\",\n  \"White-Cheeked\",\n  \"White-Winged\",\n  \"Wigeon\",\n  \"Wood-Duck\",\n  \"Yellow-Billed\"\n];\n\nfunction selectRandom(arr) {\n  return arr[Math.floor(Math.random() * arr.length)];\n}\n\nexport function generateRandomName() {\n  return `${selectRandom(names)}-${Math.floor(10000 + Math.random() * 10000)}`;\n}\n\nexport const avatarIds = avatars.map(av => av.id);\n\nexport function generateDefaultProfile() {\n  return {\n    avatarId: selectRandom(avatarIds)\n  };\n}\n","import \"./assets/stylesheets/link.scss\";\nimport React from \"react\";\nimport ReactDOM from \"react-dom\";\nimport registerTelemetry from \"./telemetry\";\nimport LinkRoot from \"./react-components/link-root\";\nimport LinkChannel from \"./utils/link-channel\";\nimport { connectToReticulum } from \"./utils/phoenix-utils\";\nimport Store from \"./storage/store\";\n\nregisterTelemetry();\n\nconst socket = connectToReticulum();\nconst store = new Store();\nstore.init();\n\nconst linkChannel = new LinkChannel(store);\n\nlinkChannel.setSocket(socket);\n\nReactDOM.render(<LinkRoot store={store} linkChannel={linkChannel} />, document.getElementById(\"link-root\"));\n","import React, { Component } from \"react\";\nimport PropTypes from \"prop-types\";\nimport { IntlProvider, FormattedMessage, addLocaleData } from \"react-intl\";\nimport en from \"react-intl/locale-data/en\";\n\nimport { lang, messages } from \"../utils/i18n\";\nimport classNames from \"classnames\";\nimport styles from \"../assets/stylesheets/link.scss\";\nimport { disableiOSZoom } from \"../utils/disable-ios-zoom\";\n\nconst MAX_DIGITS = 4;\n\naddLocaleData([...en]);\ndisableiOSZoom();\n\nclass LinkRoot extends Component {\n  static propTypes = {\n    intl: PropTypes.object,\n    store: PropTypes.object,\n    linkChannel: PropTypes.object\n  };\n\n  state = {\n    enteredDigits: \"\",\n    failedAtLeastOnce: false\n  };\n\n  componentDidMount = () => {\n    document.addEventListener(\"keydown\", this.handleKeyDown);\n  };\n\n  componentWillUnmount = () => {\n    document.removeEventListener(\"keydown\", this.handleKeyDown);\n  };\n\n  handleKeyDown = e => {\n    // Number keys 0-9\n    if (e.keyCode < 48 || e.keyCode > 57) {\n      return;\n    }\n\n    e.preventDefault();\n    e.stopPropagation();\n\n    this.addDigit(e.keyCode - 48);\n  };\n\n  addDigit = digit => {\n    if (this.state.enteredDigits.length >= MAX_DIGITS) return;\n    const newDigits = `${this.state.enteredDigits}${digit}`;\n\n    if (newDigits.length === MAX_DIGITS) {\n      this.attemptLink(newDigits);\n    }\n\n    this.setState({ enteredDigits: newDigits });\n  };\n\n  removeDigit = () => {\n    const enteredDigits = this.state.enteredDigits;\n    if (enteredDigits.length === 0) return;\n    this.setState({ enteredDigits: enteredDigits.substring(0, enteredDigits.length - 1) });\n  };\n\n  attemptLink = code => {\n    this.props.linkChannel\n      .attemptLink(code)\n      .then(response => {\n        // If there is a profile from the linked device, copy it over if we don't have one yet.\n        if (response.profile) {\n          const { hasChangedName } = this.props.store.state.activity;\n\n          if (!hasChangedName) {\n            this.props.store.update({ activity: { hasChangedName: true }, profile: response.profile });\n          }\n        }\n\n        if (response.path) {\n          window.location.href = response.path;\n        }\n      })\n      .catch(e => {\n        this.setState({ failedAtLeastOnce: true, enteredDigits: \"\" });\n\n        if (!(e instanceof Error && (e.message === \"in_use\" || e.message === \"failed\"))) {\n          throw e;\n        }\n      });\n  };\n\n  render() {\n    // Note we use type \"tel\" for the input due to https://bugzilla.mozilla.org/show_bug.cgi?id=1005603\n\n    return (\n      <IntlProvider locale={lang} messages={messages}>\n        <div className={styles.link}>\n          <div className={styles.linkContents}>\n            {this.state.enteredDigits.length === MAX_DIGITS && (\n              <div className={classNames(\"loading-panel\", styles.codeLoadingPanel)}>\n                <div className=\"loader-wrap\">\n                  <div className=\"loader\">\n                    <div className=\"loader-center\" />\n                  </div>\n                </div>\n              </div>\n            )}\n\n            <div className={styles.enteredContents}>\n              <div className={styles.header}>\n                <FormattedMessage id={this.state.failedAtLeastOnce ? \"link.try_again\" : \"link.link_page_header\"} />\n              </div>\n\n              <div className={styles.enteredDigits}>\n                <input\n                  className={styles.digitInput}\n                  type=\"tel\"\n                  pattern=\"[0-9]*\"\n                  value={this.state.enteredDigits}\n                  onChange={ev => {\n                    this.setState({ enteredDigits: ev.target.value });\n                  }}\n                  placeholder=\"- - - -\"\n                />\n              </div>\n\n              <div className={styles.enteredFooter}>\n                <span>\n                  <FormattedMessage id=\"link.dont_have_a_code\" />\n                </span>{\" \"}\n                <span>\n                  <a href=\"/\">\n                    <FormattedMessage id=\"link.create_a_room\" />\n                  </a>\n                </span>\n                <img className={styles.entryFooterImage} src=\"../assets/images/logo.svg\" />\n              </div>\n            </div>\n\n            <div className={styles.keypad}>\n              {[1, 2, 3, 4, 5, 6, 7, 8, 9].map((d, i) => (\n                <button\n                  disabled={this.state.enteredDigits.length === MAX_DIGITS}\n                  key={`digit_${i}`}\n                  className={styles.keypadButton}\n                  onClick={() => this.addDigit(d)}\n                >\n                  {d}\n                </button>\n              ))}\n              <button\n                disabled={this.state.enteredDigits.length === MAX_DIGITS}\n                className={classNames(styles.keypadButton, styles.keypadZeroButton)}\n                onClick={() => this.addDigit(0)}\n              >\n                0\n              </button>\n              <button\n                disabled={this.state.enteredDigits.length === 0 || this.state.enteredDigits.length === MAX_DIGITS}\n                className={classNames(styles.keypadButton, styles.keypadBackspace)}\n                onClick={() => this.removeDigit()}\n              >\n                ⌫\n              </button>\n            </div>\n\n            <div className={styles.footer}>\n              <span>\n                <FormattedMessage id=\"link.dont_have_a_code\" />\n              </span>{\" \"}\n              <span>\n                <a href=\"/\">\n                  <FormattedMessage id=\"link.create_a_room\" />\n                </a>\n              </span>\n              <img className={styles.footerImage} src=\"../assets/images/logo.svg\" alt=\"Logo\" />\n            </div>\n          </div>\n        </div>\n      </IntlProvider>\n    );\n  }\n}\n\nexport default LinkRoot;\n","// removed by extract-text-webpack-plugin\nmodule.exports = {\"keypad-button\":\"link__keypad-button__2ElvK\",\"keypadButton\":\"link__keypad-button__2ElvK\",\"link\":\"link__link__3kJ6B\",\"link-contents\":\"link__link-contents__3L1rY\",\"linkContents\":\"link__link-contents__3L1rY\",\"entered-footer\":\"link__entered-footer__2Oi0C\",\"enteredFooter\":\"link__entered-footer__2Oi0C\",\"entered-contents\":\"link__entered-contents__2ZmCP\",\"enteredContents\":\"link__entered-contents__2ZmCP\",\"code-loading-panel\":\"link__code-loading-panel__21IQD\",\"codeLoadingPanel\":\"link__code-loading-panel__21IQD\",\"entry-footer-image\":\"link__entry-footer-image__1XOeK\",\"entryFooterImage\":\"link__entry-footer-image__1XOeK\",\"footer-image\":\"link__footer-image__AsDh-\",\"footerImage\":\"link__footer-image__AsDh-\",\"header\":\"link__header__ID1fV\",\"footer\":\"link__footer__DERRP\",\"keypad\":\"link__keypad__1FVTF\",\"keypad-zero-button\":\"link__keypad-zero-button__1Ipl5\",\"keypadZeroButton\":\"link__keypad-zero-button__1Ipl5\",\"keypad-backspace\":\"link__keypad-backspace__M4x5m\",\"keypadBackspace\":\"link__keypad-backspace__M4x5m\",\"entered-digits\":\"link__entered-digits__3j6yk\",\"enteredDigits\":\"link__entered-digits__3j6yk\",\"digit\":\"link__digit__9CLdI\",\"digit-input\":\"link__digit-input__3pC9t\",\"digitInput\":\"link__digit-input__3pC9t\"};","module.exports = __webpack_public_path__ + \"assets/images/logo-8f1dfd234d060073524bc29912a24f75.svg\";","import { generatePublicKeyAndEncryptedObject, generateKeys, decryptObject } from \"./crypto\";\n\nconst LINK_ACTION_TIMEOUT = 10000;\n\nexport default class LinkChannel {\n  constructor(store) {\n    this.store = store;\n  }\n\n  setSocket = socket => {\n    this.socket = socket;\n  };\n\n  // Returns a promise that, when resolved, will forward an object with three keys:\n  //\n  // code: The code that was made available to use for link.\n  //\n  // cancel: A function that the caller can call to cancel the use of the code.\n  //\n  // onFinished: A promise that, when resolved, indicates the code is no longer usable,\n  // because it was either successfully used by the remote device or it has expired\n  // (\"used\" or \"expired\" is passed to the callback).\n  generateCode = () => {\n    return new Promise(resolve => {\n      const onFinished = new Promise(finished => {\n        const step = () => {\n          const code = Math.floor(Math.random() * 9999)\n            .toString()\n            .padStart(4, \"0\");\n\n          // Only respond to one link_request in this channel.\n          let readyToSend = false;\n          let leftChannel = false;\n\n          const channel = this.socket.channel(`link:${code}`, { timeout: LINK_ACTION_TIMEOUT });\n\n          const leave = () => {\n            if (!leftChannel) channel.leave();\n            leftChannel = true;\n          };\n\n          const cancel = () => leave();\n\n          channel.on(\"link_expired\", () => finished(\"expired\"));\n\n          channel.on(\"presence_state\", state => {\n            if (readyToSend) return;\n\n            if (Object.keys(state).length > 0) {\n              // Code is in use by someone else, try a new one\n              step();\n            } else {\n              readyToSend = true;\n              resolve({ code, cancel, onFinished });\n            }\n          });\n\n          channel.on(\"link_request\", incoming => {\n            if (readyToSend) {\n              const data = { path: location.pathname };\n\n              // Copy profile data to link'ed device if it's been set.\n              if (this.store.state.activity.hasChangedName) {\n                data.profile = { ...this.store.state.profile };\n              }\n\n              generatePublicKeyAndEncryptedObject(incoming.public_key, data).then(\n                ({ publicKeyString, encryptedData }) => {\n                  const payload = {\n                    target_session_id: incoming.reply_to_session_id,\n                    public_key: publicKeyString,\n                    data: encryptedData\n                  };\n\n                  if (!leftChannel) {\n                    channel.push(\"link_response\", payload);\n                  }\n\n                  leave();\n\n                  finished(\"used\");\n                  readyToSend = false;\n                }\n              );\n            }\n          });\n\n          channel.join().receive(\"error\", r => console.error(r));\n        };\n\n        step();\n      });\n    });\n  };\n\n  // Attempts to receive a link payload from a remote device using the given code.\n  //\n  // Promise rejects if the code is invalid or there is a problem with the channel.\n  // Promise resolves and passes payload of link source on successful link.\n  attemptLink = code => {\n    return new Promise((resolve, reject) => {\n      const channel = this.socket.channel(`link:${code}`, { timeout: LINK_ACTION_TIMEOUT });\n      let finished = false;\n\n      generateKeys().then(({ publicKeyString, privateKey }) => {\n        channel.on(\"presence_state\", state => {\n          const numOccupants = Object.keys(state).length;\n\n          if (numOccupants === 1) {\n            // Great, only sender is in topic, request link\n            channel.push(\"link_request\", {\n              reply_to_session_id: this.socket.params.session_id,\n              public_key: publicKeyString\n            });\n\n            setTimeout(() => {\n              if (finished) return;\n              channel.leave();\n              reject(new Error(\"no_response\"));\n            }, LINK_ACTION_TIMEOUT);\n          } else if (numOccupants === 0) {\n            // Nobody in this channel, probably a bad code.\n            channel.leave();\n            reject(new Error(\"failed\"));\n          } else {\n            console.warn(\"link code channel already has 2 or more occupants, something fishy is going on.\");\n            channel.leave();\n            reject(new Error(\"in_use\"));\n          }\n        });\n\n        channel.on(\"link_response\", payload => {\n          finished = true;\n          channel.leave();\n\n          decryptObject(payload.public_key, privateKey, payload.data).then(resolve);\n        });\n\n        channel.join().receive(\"error\", r => console.error(r));\n      });\n    });\n  };\n}\n","// NOTE: We do not use an IV since we generate a new keypair each time we use these routines.\n\nasync function deriveKey(privateKey, publicKey) {\n  return crypto.subtle.deriveKey(\n    { name: \"ECDH\", public: publicKey },\n    privateKey,\n    { name: \"AES-CBC\", length: 256 },\n    true,\n    [\"encrypt\", \"decrypt\"]\n  );\n}\n\nasync function publicKeyToString(key) {\n  return JSON.stringify(await crypto.subtle.exportKey(\"jwk\", key));\n}\n\nasync function stringToPublicKey(s) {\n  return await crypto.subtle.importKey(\"jwk\", JSON.parse(s), { name: \"ECDH\", namedCurve: \"P-256\" }, true, []);\n}\n\nfunction stringToArrayBuffer(s) {\n  const buf = new Uint8Array(s.length);\n\n  for (let i = 0; i < s.length; i++) {\n    buf[i] = s.charCodeAt(i);\n  }\n\n  return buf;\n}\n\nfunction arrayBufferToString(b) {\n  const buf = new Uint8Array(b);\n  let s = \"\";\n\n  for (let i = 0; i < buf.byteLength; i++) {\n    s += String.fromCharCode(buf[i]);\n  }\n\n  return s;\n}\n\n// This allows a single object to be passed encrypted from a receiver in a req -> response flow\n\n// Requestor generates a public key and private key, and should send the public key to receiver.\nexport async function generateKeys() {\n  const keyPair = await crypto.subtle.generateKey({ name: \"ECDH\", namedCurve: \"P-256\" }, true, [\"deriveKey\"]);\n  const publicKeyString = await publicKeyToString(keyPair.publicKey);\n  return { publicKeyString, privateKey: keyPair.privateKey };\n}\n\n// Receiver takes the public key from requestor and passes obj to get a response public key and the encrypted data to return.\nexport async function generatePublicKeyAndEncryptedObject(incomingPublicKeyString, obj) {\n  const iv = new Uint8Array(16);\n  const incomingPublicKey = await stringToPublicKey(incomingPublicKeyString);\n  const keyPair = await crypto.subtle.generateKey({ name: \"ECDH\", namedCurve: \"P-256\" }, true, [\"deriveKey\"]);\n  const publicKeyString = await publicKeyToString(keyPair.publicKey);\n  const secret = await deriveKey(keyPair.privateKey, incomingPublicKey);\n\n  const encryptedData = btoa(\n    arrayBufferToString(\n      await crypto.subtle.encrypt({ name: \"AES-CBC\", iv }, secret, stringToArrayBuffer(JSON.stringify(obj)))\n    )\n  );\n\n  return { publicKeyString, encryptedData };\n}\n\n// Requestor then takes the receiver's public key, the private key (returned from generateKeys()), and the data from the receiver.\nexport async function decryptObject(publicKeyString, privateKey, base64value) {\n  const iv = new Uint8Array(16);\n  const publicKey = await stringToPublicKey(publicKeyString);\n  const secret = await deriveKey(privateKey, publicKey);\n  const ciphertext = stringToArrayBuffer(atob(base64value));\n  const data = await crypto.subtle.decrypt({ name: \"AES-CBC\", iv }, secret, ciphertext);\n  return JSON.parse(arrayBufferToString(data));\n}\n","import uuid from \"uuid/v4\";\nimport { Socket } from \"phoenix\";\n\nexport function connectToReticulum() {\n  const qs = new URLSearchParams(location.search);\n\n  const socketProtocol = qs.get(\"phx_protocol\") || (document.location.protocol === \"https:\" ? \"wss:\" : \"ws:\");\n  let socketHost = qs.get(\"phx_host\");\n  let socketPort = qs.get(\"phx_port\");\n\n  if (process.env.RETICULUM_SERVER) {\n    const [retHost, retPort] = process.env.RETICULUM_SERVER.split(\":\");\n    socketHost = socketHost || retHost || \"\";\n    socketPort = socketPort || retPort || \"443\";\n  } else {\n    socketHost = socketHost || document.location.hostname || \"\";\n    socketPort = socketPort || document.location.port || \"443\";\n  }\n\n  const socketUrl = `${socketProtocol}//${socketHost}${socketPort ? `:${socketPort}` : \"\"}/socket`;\n  console.log(`Phoenix Socket URL: ${socketUrl}`);\n\n  const socket = new Socket(socketUrl, { params: { session_id: uuid() } });\n  socket.connect();\n\n  return socket;\n}\n","import { detectOS } from \"detect-browser\";\n\nexport function disableiOSZoom() {\n  if (detectOS(navigator.userAgent) !== \"iOS\") return;\n\n  let lastTouchAtMs = 0;\n\n  document.addEventListener(\"touchmove\", ev => {\n    if (ev.scale === 1) return;\n\n    ev.preventDefault();\n  });\n\n  document.addEventListener(\"touchend\", ev => {\n    const now = new Date().getTime();\n    const isDoubleTouch = now - lastTouchAtMs <= 300;\n    lastTouchAtMs = now;\n\n    if (isDoubleTouch) {\n      ev.preventDefault();\n    }\n  });\n}\n"],"sourceRoot":""}